<!DOCTYPE HTML>
<html>
<head>
    <title>iframe element src attribute must match src list</title>
    <script src='/resources/testharness.js'></script>
    <script src='/resources/testharnessreport.js'></script>
    <link rel='stylesheet' href='/resources/testharness.css'>
</head>
<body>
    <h1>iframe element src attribute must match src list</h1>
    <div id='log'></div>

<script>
var selfTest = async_test("Iframe loaded from self (as allowed by frame-src policy)");
var nonSelfTest = async_test("Iframe not loaded from www1.web-platform.test (as denied by frame-src policy)");

function checkiFrameLoad(name) {
    iframe = document.getElementById("nonSelfiFrame");
    var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
    // Check if loading is complete
    if (  iframeDoc.readyState  == 'complete' ) {
        assert_unreached("bad iframe from www1.web-platform.test was loaded");
        return;
    }
    window.setTimeout('checkiFrameLoad();', 100);  
}
</script>
    <iframe src="frame-src-5_1yes.html" onload='selfTest.done()'></iframe>
    <iframe src="http://www1.web-platform.test:8000/content-security-policy/frame-src/frame-src-5_1no.html" id="nonSelfiFrame" onload='nonSelfTest.step(assert_unreached("iframe from non-self frame-src loaded")'></iframe>

    <script async defer src='../support/checkReport.sub.js?reportField=violated-directive&reportValue=frame-src%20%27self%27'></script> 
    <script>
        checkiFrameLoad();
    	nonSelfTest.done();
    </script>
</body>
</html>
